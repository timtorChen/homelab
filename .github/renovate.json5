// Renovate common configs
// https://docs.renovatebot.com/configuration-options/
{
  timezone: "Asia/Taipei",
  dependencyDashboard: true,
  commitMessagePrefix: "(bot)",
  kubernetes: {
    fileMatch: ["cluster/.*\\.yaml$"],
    ignorePaths: ["cluster/base/"],
  },
  regexManagers: [
    {
      fileMatch: ["^cluster/.*\\.yaml$"],
      matchStrings: [
        // Helmrelease
        "registryUrl=(?<registryUrl>.*?)\n *chart: (?<depName>.*?)\n *version: (?<currentValue>.*?)\n",
        // CRD Gitrepo follows helm version
        "registryUrl=(?<registryUrl>.*?) chart=(?<depName>.*?)\n *tag: ([a-z-]+-)?(?<currentValue>[v]?\\S+)",
        // cert-manager Kustomization
        "registryUrl=(?<registryUrl>.*?) chart=(?<depName>.*?)\n.*(?<currentValue>v\\d+\\.\\d+\\.\\d+)",
      ],
      datasourceTemplate: "helm",
    },
    {
      // CRD Gitrepo
      fileMatch: ["^cluster/.*\\.yaml$"],
      matchStrings: [
        "repo=(?<depName>.*?)\n *tag: (?<currentValue>\\S+)"
      ],
      datasourceTemplate: "github-tags"
    }
  ],
}
