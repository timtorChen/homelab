// Renovate common configs
// https://docs.renovatebot.com/configuration-options/
{
  timezone: "Asia/Taipei",
  dependencyDashboard: true,
  commitMessagePrefix: "(bot)",
  kubernetes: {
    fileMatch: ["cluster/.*\\.yaml$"],
    ignorePaths: ["cluster/base/"],
  },
  regexManagers: [
    {
      fileMatch: ["^cluster/.*\\.yaml$"],
      matchStrings: [
        //- Helmrelease
        "registryUrl=(?<registryUrl>.*?)\n *chart: (?<depName>.*?)\n *version: (?<currentValue>.*?)\n",
        
        //- CRD Gitrepo and Kustomization
        // common
        "registryUrl=(?<registryUrl>.*?) chart=(?<depName>.*?)\n *tag: (?<currentValue>.*?)\n",
        // tag with a prefix the same as chart name
        "registryUrl=(?<registryUrl>.*?)\n *tag: (?<depName>[a-z-]+)-(?<currentValue>.*?)\n",  
        // cert-manager
        "registryUrl=(?<registryUrl>.*?) chart=(?<depName>.*?)\n.*(?<currentValue>v\\d+\\.\\d+\\.\\d+)\n",
      ],
      datasourceTemplate: "helm",
    },
    {
      //- Kustomization
      fileMatch: ["^cluster/.*\\.yaml$"],
      matchStrings: [
        "repo=(?<depName>.*?)\n *tag: (?<currentValue>.*?)\n"
      ],
      datasourceTemplate: "github-tags"
    }
  ],
}
